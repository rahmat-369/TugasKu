<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>TugasKu - AI Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="assets/my-icon.png">
  <style>
    /* Import styles dari index.html */
    :root {
      --primary: #3B82F6;
      --primary-600: #2563EB;
      --bg: #f8fafc;
      --card: #ffffff;
      --muted: #6b7280;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --glass: rgba(255,255,255,0.5);
      --radius: 14px;
      --shadow: 0 6px 18px rgba(16,24,40,0.06);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    .dark-mode {
      --bg: #0b1220;
      --card: #0f1724;
      --muted: #cbd5e1;
      --glass: rgba(20,25,34,0.6);
      color: #e6eef8;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--bg);
      color: #0f1724;
      transition: background .25s, color .25s;
      display: flex;
      flex-direction: column;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 100%;
      margin: 0 auto;
      padding: 12px;
      height: 100%;
    }

    header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(0,0,0,0.08);
    }

    .dark-mode header {
      border-bottom-color: rgba(255,255,255,0.08);
    }

    .back-btn {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--primary);
    }

    .logo {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--card);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .chat-header {
      padding: 20px;
      background: var(--primary);
      color: white;
      text-align: center;
    }

    .chat-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .message {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: 18px;
      line-height: 1.4;
    }

    .ai-message {
      align-self: flex-start;
      background: rgba(0,0,0,0.05);
      border-bottom-left-radius: 6px;
    }

    .dark-mode .ai-message {
      background: rgba(255,255,255,0.08);
    }

    .user-message {
      align-self: flex-end;
      background: var(--primary);
      color: white;
      border-bottom-right-radius: 6px;
    }

    .typing-indicator {
      align-self: flex-start;
      background: rgba(0,0,0,0.05);
      padding: 12px 16px;
      border-radius: 18px;
      border-bottom-left-radius: 6px;
      display: none;
    }

    .dark-mode .typing-indicator {
      background: rgba(255,255,255,0.08);
    }

    .typing-dots {
      display: flex;
      gap: 4px;
    }

    .typing-dots span {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--muted);
      animation: typing 1.4s infinite;
    }

    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { opacity: 0.3; }
      30% { opacity: 1; }
    }

    .input-container {
      padding: 16px;
      border-top: 1px solid rgba(0,0,0,0.08);
      display: flex;
      gap: 12px;
      background: var(--card);
    }

    .dark-mode .input-container {
      border-top-color: rgba(255,255,255,0.08);
    }

    #messageInput {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 24px;
      background: var(--glass);
      font-family: inherit;
      outline: none;
    }

    .dark-mode #messageInput {
      border-color: rgba(255,255,255,0.1);
    }

    #sendButton {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .suggestion-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 0 16px 16px;
      background: var(--card);
    }

    .suggestion-chip {
      background: rgba(59,130,246,0.1);
      color: var(--primary);
      padding: 8px 12px;
      border-radius: 16px;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid rgba(59,130,246,0.2);
      transition: all 0.2s;
    }

    .suggestion-chip:hover {
      background: rgba(59,130,246,0.2);
    }

    .feature-list {
      list-style: none;
      padding: 0;
    }

    .feature-list li {
      padding: 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .feature-list input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <button class="back-btn" onclick="goBack()">←</button>
      <div class="logo">AI</div>
      <h1>AI Assistant</h1>
    </header>

    <div class="chat-container">
      <div class="chat-header">
        <h2>TugasKu - Smart Input</h2>
        <p>Saya bisa membantu Anda menambah tugas, jadwal, dan catatan!</p>
      </div>

      <div class="chat-messages" id="chatMessages">
        <div class="message ai-message">
          <p><strong>Hai! Saya asisten AI TugasKu. Saya bisa membantu Anda:</strong></p>
          <ul class="feature-list">
            <li><input type="checkbox"> <strong>Menambah tugas</strong> (contoh: "PR Matematika halaman 20 deadline besok")</li>
            <li><input type="checkbox"> <strong>Menambah jadwal</strong> (contoh: "Jadwal Fisika hari Senin jam 08:00")</li>
            <li><input type="checkbox" checked> <strong>Mencatat catatan</strong> (contoh: "Catat: bawa buku gambar untuk seni")</li>
          </ul>
          <p style="margin-top: 12px;">Coba ketik permintaan Anda dengan bahasa natural!</p>
        </div>
      </div>

      <div class="typing-indicator" id="typingIndicator">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>

      <div class="suggestion-chips">
        <div class="suggestion-chip" onclick="insertSuggestion('PR Matematika halaman 20 deadline besok')">Tugas Matematika</div>
        <div class="suggestion-chip" onclick="insertSuggestion('Jadwal Fisika hari Senin jam 08:00')">Jadwal Fisika</div>
        <div class="suggestion-chip" onclick="insertSuggestion('Catat: bawa buku gambar untuk seni')">Catatan Penting</div>
        <div class="suggestion-chip" onclick="insertSuggestion('Tugas IPA halaman 45 untuk besok')">Tugas IPA</div>
      </div>

      <div class="input-container">
        <input type="text" id="messageInput" placeholder="Ketik pesan di sini... Contoh: 'Tugas IPA halaman 45 untuk besok'">
        <button id="sendButton">↑</button>
      </div>
    </div>
  </div>

  <script>
    // Storage Manager (sama seperti di index.html)
    class StorageManager {
      static STORAGE_KEYS = {
        TASKS: 'pr_tasks_v3',
        SCHEDULES: 'pr_schedules_v1', 
        NOTES: 'pr_notes_v1'
      };

      static getTasks() {
        return this._get(this.STORAGE_KEYS.TASKS, []);
      }

      static saveTasks(tasks) {
        this._set(this.STORAGE_KEYS.TASKS, tasks);
      }

      static getSchedules() {
        return this._get(this.STORAGE_KEYS.SCHEDULES, []);
      }

      static saveSchedules(schedules) {
        this._set(this.STORAGE_KEYS.SCHEDULES, schedules);
      }

      static getNotes() {
        return this._get(this.STORAGE_KEYS.NOTES, []);
      }

      static saveNotes(notes) {
        this._set(this.STORAGE_KEYS.NOTES, notes);
      }

      static _get(key, defaultValue) {
        try {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : defaultValue;
        } catch (error) {
          console.error(`Error reading ${key}:`, error);
          return defaultValue;
        }
      }

      static _set(key, value) {
        try {
          localStorage.setItem(key, JSON.stringify(value));
          return true;
        } catch (error) {
          console.error(`Error saving ${key}:`, error);
          return false;
        }
      }
    }

    // AI Processing Functions
    class AIProcessor {
      static parseMessage(message) {
        const lowerMessage = message.toLowerCase();
        
        // Task detection
        if (lowerMessage.includes('tugas') || lowerMessage.includes('pr') || lowerMessage.includes('deadline')) {
          return this.parseTask(message);
        }
        
        // Schedule detection
        if (lowerMessage.includes('jadwal') || lowerMessage.includes('jam') || 
            lowerMessage.includes('senin') || lowerMessage.includes('selasa') || 
            lowerMessage.includes('rabu') || lowerMessage.includes('kamis') || 
            lowerMessage.includes('jumat') || lowerMessage.includes('sabtu')) {
          return this.parseSchedule(message);
        }
        
        // Note detection
        if (lowerMessage.includes('catat') || lowerMessage.includes('catatan') || 
            lowerMessage.includes('ingat') || lowerMessage.includes('note')) {
          return this.parseNote(message);
        }
        
        return { type: 'unknown', message: 'Maaf, saya tidak mengerti permintaan Anda. Coba gunakan format yang lebih jelas.' };
      }

      static parseTask(message) {
        const task = {
          type: 'task',
          subject: '',
          name: '',
          deadline: '',
          notes: '',
          priority: 'medium'
        };

        // Extract subject (usually before "halaman" or "bab")
        const subjectMatch = message.match(/(tugas|pr)\s+(\w+)/i);
        if (subjectMatch) {
          task.subject = subjectMatch[2].charAt(0).toUpperCase() + subjectMatch[2].slice(1);
        }

        // Extract page/chapter
        const pageMatch = message.match(/halaman\s+(\d+)/i) || message.match(/bab\s+(\d+)/i);
        if (pageMatch) {
          task.name = `PR Halaman ${pageMatch[1]}`;
        }

        // Extract deadline
        const today = new Date();
        if (message.includes('besok')) {
          const tomorrow = new Date(today);
          tomorrow.setDate(tomorrow.getDate() + 1);
          task.deadline = tomorrow.toISOString().split('T')[0];
        } else if (message.includes('hari ini')) {
          task.deadline = today.toISOString().split('T')[0];
        } else {
          // Default to tomorrow if no deadline specified
          const tomorrow = new Date(today);
          tomorrow.setDate(tomorrow.getDate() + 1);
          task.deadline = tomorrow.toISOString().split('T')[0];
        }

        // Extract additional notes
        if (message.includes('untuk')) {
          const forIndex = message.indexOf('untuk');
          task.notes = message.substring(forIndex + 5).trim();
        }

        return task;
      }

      static parseSchedule(message) {
        const schedule = {
          type: 'schedule',
          subject: '',
          day: '',
          time: ''
        };

        // Extract subject
        const subjectMatch = message.match(/jadwal\s+(\w+)/i);
        if (subjectMatch) {
          schedule.subject = subjectMatch[1].charAt(0).toUpperCase() + subjectMatch[1].slice(1);
        }

        // Extract day
        const days = ['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu'];
        for (const day of days) {
          if (message.includes(day)) {
            schedule.day = day;
            break;
          }
        }

        // Extract time
        const timeMatch = message.match(/jam\s+(\d{1,2}[:.]?\d{0,2})/i) || 
                         message.match(/(\d{1,2}[:.]\d{2})/);
        if (timeMatch) {
          let timeStr = timeMatch[1].replace('.', ':');
          if (!timeStr.includes(':')) {
            timeStr += ':00';
          }
          schedule.time = timeStr;
        } else {
          schedule.time = '08:00'; // Default time
        }

        return schedule;
      }

      static parseNote(message) {
        const note = {
          type: 'note',
          title: '',
          content: ''
        };

        // Remove "catat" prefix
        let cleanMessage = message.replace(/^(catat|ingat)\s*:\s*/i, '').trim();

        // Use first few words as title, rest as content
        const words = cleanMessage.split(' ');
        if (words.length > 3) {
          note.title = words.slice(0, 3).join(' ');
          note.content = words.slice(3).join(' ');
        } else {
          note.title = cleanMessage;
          note.content = 'Catatan penting';
        }

        return note;
      }

      static generateResponse(result, originalMessage) {
        if (result.type === 'unknown') {
          return result.message;
        }

        const responses = {
          task: `✅ Tugas "${result.subject} - ${result.name}" telah ditambahkan dengan deadline ${this.formatDate(result.deadline)}.`,
          schedule: `📅 Jadwal "${result.subject}" pada hari ${result.day} jam ${result.time} telah ditambahkan.`,
          note: `📝 Catatan "${result.title}" telah disimpan.`
        };

        return responses[result.type] || 'Permintaan Anda telah diproses.';
      }

      static formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString('id-ID', { 
          day: 'numeric', 
          month: 'long', 
          year: 'numeric' 
        });
      }
    }

    // Chat UI Management
    class ChatManager {
      constructor() {
        this.chatMessages = document.getElementById('chatMessages');
        this.messageInput = document.getElementById('messageInput');
        this.sendButton = document.getElementById('sendButton');
        this.typingIndicator = document.getElementById('typingIndicator');
        
        this.initEventListeners();
      }

      initEventListeners() {
        this.sendButton.addEventListener('click', () => this.sendMessage());
        this.messageInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            this.sendMessage();
          }
        });
      }

      addMessage(message, isUser = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
        messageDiv.innerHTML = `<p>${message}</p>`;
        
        this.chatMessages.appendChild(messageDiv);
        this.scrollToBottom();
      }

      showTyping() {
        this.typingIndicator.style.display = 'block';
        this.scrollToBottom();
      }

      hideTyping() {
        this.typingIndicator.style.display = 'none';
      }

      scrollToBottom() {
        setTimeout(() => {
          this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
        }, 100);
      }

      async sendMessage() {
        const message = this.messageInput.value.trim();
        if (!message) return;

        // Add user message
        this.addMessage(message, true);
        this.messageInput.value = '';

        // Show typing indicator
        this.showTyping();

        // Simulate AI processing delay
        setTimeout(() => {
          this.hideTyping();
          this.processAIResponse(message);
        }, 1500);
      }

      processAIResponse(message) {
        const result = AIProcessor.parseMessage(message);
        
        if (result.type !== 'unknown') {
          // Save to appropriate storage
          this.saveToStorage(result);
        }

        const response = AIProcessor.generateResponse(result, message);
        this.addMessage(response);
      }

      saveToStorage(data) {
        switch (data.type) {
          case 'task':
            const tasks = StorageManager.getTasks();
            const newTask = {
              id: Date.now(),
              subject: data.subject,
              name: data.name,
              deadline: data.deadline,
              notes: data.notes,
              priority: data.priority,
              status: 'new',
              createdAt: Date.now()
            };
            tasks.push(newTask);
            StorageManager.saveTasks(tasks);
            break;

          case 'schedule':
            const schedules = StorageManager.getSchedules();
            const newSchedule = {
              id: Date.now(),
              subject: data.subject,
              day: data.day,
              time: data.time
            };
            schedules.push(newSchedule);
            StorageManager.saveSchedules(schedules);
            break;

          case 'note':
            const notes = StorageManager.getNotes();
            const newNote = {
              id: Date.now(),
              title: data.title,
              content: data.content,
              createdAt: Date.now(),
              updatedAt: Date.now()
            };
            notes.push(newNote);
            StorageManager.saveNotes(notes);
            break;
        }
      }
    }

    // Utility Functions
    function goBack() {
      window.history.back();
    }

    function insertSuggestion(text) {
      document.getElementById('messageInput').value = text;
      document.getElementById('messageInput').focus();
    }

    // Initialize theme
    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.className = savedTheme;
    }

    // Initialize app when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      initTheme();
      new ChatManager();
    });
  </script>
</body>
</html>